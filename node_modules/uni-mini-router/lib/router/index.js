/*!
 * uni-mini-router v0.1.5
 * 2023/10/23 10:32:53 weisheng
 */
import{NavMethod as e,NavTypeEnum as r}from"../interfaces/index.js";import{beautifyUrl as t,getUrlParams as n,queryStringify as a,setUrlParams as o}from"../utils/index.js";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(e){var r=function(e,r){if("object"!==i(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===i(r)?r:r+""}function c(e,r,t){return(r=u(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var r=1;arguments.length>r;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){c(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var s={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,reLaunch:uni.reLaunch,switchTab:uni.switchTab,navigateBack:uni.navigateBack};function p(e,r,t){var n=v(e,r);switch(t){case"push":s.navigateTo({url:n});break;case"replace":s.redirectTo({url:n});break;case"pushTab":s.switchTab({url:n});break;case"replaceAll":s.reLaunch({url:n});break;default:throw Error("无效的路由类型，请确保提供正确的路由类型")}}function v(e,r){var i="",u={};if("string"==typeof e)i=e;else{if(e.name){var c=r.routes.find((function(r){return r.name===e.name}));if(!c||!c.path)throw Error("您正在尝试访问的路由未在路由表中定义。请检查您的路由配置。");i=c.path,u=e.params}else e.path&&(i=t("/".concat(e.path.split("?")[0])),u=f(f({},n(e.path)),e.query||{}));u&&(u=a(u),i=o(i,u))}return i}function g(){var e=getCurrentPages();return e.length>0?e[e.length-1]:void 0}function h(e){e.route.value=b(e)}function b(e){var r=g();if(r&&r.route&&e.routes){var t=y("/".concat(r.route),e);return r.$page&&(t.fullPath=r.$page.fullPath?r.$page.fullPath:"",t.query=r.$page.fullPath?n(r.$page.fullPath):{},t.params=r.$page.fullPath?n(r.$page.fullPath):{}),t}}function y(e,r){e=e.split("?")[0];var t=r.routes.find((function(r){return r.path===e||r.aliasPath===e}));return JSON.parse(JSON.stringify(t))}function m(e,r,t){e.guardHooks[r]=[t]}var d={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,reLaunch:uni.reLaunch,switchTab:uni.switchTab,navigateBack:uni.navigateBack};function P(t){e.forEach((function(e){s[e]=function(n){if("navigateBack"===e)d[e](n);else if(t.guardHooks.beforeHooks&&t.guardHooks.beforeHooks[0]){var a=y(n.url,t);w(t.guardHooks.beforeHooks[0],a,t.route.value).then((function(a){if(!0===a)d[e](n);else if("string"==typeof a){var o=v(a,t);d[e]({url:o})}else if("back"===a.navType)d.navigateBack(a);else{var i=v(a,t);d[a.navType?r[a.navType]:e]({url:i})}})).catch((function(e){throw e}))}else d[e](n)}}))}function w(e,r,t){return new Promise((function(n,a){var o=function e(r){e._called=!0,!1===r?a({}):n(void 0===r||!0===r||r)},u=e.call(void 0,r,t,o),c=Promise.resolve(u);if(3>e.length&&(c=c.then(o)),e.length>2){var l='The "next" callback was never called inside of '.concat(e.name?'"'+e.name+'"':"",":\n").concat(""+e,'\n. If you are returning a value instead of calling "next", make sure to remove the "next" parameter from your function.');if(null!==u&&"object"===i(u)&&"then"in u)c=c.then((function(e){return o._called?e:(console.warn(l),Promise.reject(Error("Invalid navigation guard")))}));else if(!o._called)return console.warn(l),void a(Error("Invalid navigation guard"))}c.catch((function(e){return a(e)}))}))}export{g as getCurrentPage,b as getCurrentPageRoute,y as getRouteByPath,v as getRoutePath,w as guardToPromiseFn,p as navjump,m as registerEachHooks,P as rewriteNavMethod,h as saveCurrRouteByCurrPage};
